# Aether LSP åŠŸèƒ½è·¯çº¿å›¾

## ğŸ“Š å½“å‰çŠ¶æ€æ€»è§ˆ

### âœ… å·²å®Œæˆ (Phase 1)

| åŠŸèƒ½ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| è¯­æ³•é«˜äº® | âœ… 100% | TextMate è¯­æ³•æ–‡ä»¶ |
| è¯æ³•åˆ†æ | âœ… 100% | æ”¯æŒå¤šè¡Œå­—ç¬¦ä¸²ã€æ³¨é‡Šã€BigInteger |
| è¯­æ³•åˆ†æ | âœ… 100% | å®Œæ•´ Aether è¯­æ³•æ”¯æŒ |
| ç¬¦å·æå– | âœ… 90% | æå–å˜é‡/å‡½æ•°ï¼Œä½ç½®å¾…ç²¾ç¡®åŒ– |
| ä»£ç è¡¥å…¨ | âœ… 95% | å…³é”®å­— + 53 ä¸ªå†…ç½®å‡½æ•° |
| å®æ—¶è¯Šæ–­ | âœ… 90% | è¯­æ³•é”™è¯¯ + å‘½åæ£€æŸ¥ |
| åŸºç¡€æ¶æ„ | âœ… 100% | LSP æœåŠ¡å™¨ + VSCode æ‰©å±• |

**æ€»ä½“å®Œæˆåº¦: 85%**

---

## ğŸ¯ åŠŸèƒ½ä¼˜å…ˆçº§çŸ©é˜µ

### è¯„åˆ†æ ‡å‡†

- **é‡è¦æ€§**: å¯¹ç”¨æˆ·ä½“éªŒçš„å½±å“ (1-5)
- **ç´§æ€¥åº¦**: é˜»å¡å…¶ä»–åŠŸèƒ½çš„ç¨‹åº¦ (1-5)
- **å¤æ‚åº¦**: å®ç°éš¾åº¦ (1-5, è¶Šé«˜è¶Šéš¾)
- **ä¼˜å…ˆçº§**: é‡è¦æ€§ Ã— ç´§æ€¥åº¦ / å¤æ‚åº¦

| åŠŸèƒ½ | é‡è¦æ€§ | ç´§æ€¥åº¦ | å¤æ‚åº¦ | ä¼˜å…ˆçº§ | å·¥ä½œé‡ |
|------|--------|--------|--------|--------|--------|
| **ç²¾ç¡®ç¬¦å·ä½ç½®** | 5 | 5 | 3 | 8.3 | 2-3å¤© |
| **Hover åŠŸèƒ½** | 5 | 4 | 2 | 10.0 | 1-2å¤© |
| **ä»£ç æ ¼å¼åŒ–** | 4 | 3 | 4 | 3.0 | 3-4å¤© |
| **é‡å‘½å** | 4 | 3 | 3 | 4.0 | 2-3å¤© |
| **æŸ¥æ‰¾å¼•ç”¨** | 4 | 3 | 2 | 6.0 | 1-2å¤© |
| **ä»£ç ç‰‡æ®µ** | 3 | 2 | 1 | 6.0 | 1å¤© |
| **ç±»å‹æ¨æ–­** | 5 | 2 | 5 | 2.0 | 1-2å‘¨ |
| **æœªä½¿ç”¨å˜é‡æ£€æµ‹** | 3 | 2 | 3 | 2.0 | 3-5å¤© |
| **å·¥ä½œåŒºç¬¦å·** | 3 | 2 | 2 | 3.0 | 2å¤© |
| **ä»£ç æŠ˜å ** | 2 | 1 | 2 | 1.0 | 1å¤© |

---

## ğŸ“… å¼€å‘æ—¶é—´çº¿

### Phase 1: æ ¸å¿ƒåŠŸèƒ½ âœ… (å·²å®Œæˆ - 2å‘¨)

**ç›®æ ‡**: åŸºç¡€ LSP åŠŸèƒ½å¯ç”¨

- [x] é›†æˆ Parser + Lexer
- [x] ç¬¦å·è¡¨æå–
- [x] ä»£ç è¡¥å…¨ï¼ˆå…³é”®å­— + å†…ç½®å‡½æ•°ï¼‰
- [x] è¯­æ³•è¯Šæ–­
- [x] VSCode æ‰©å±•æ¡†æ¶

**äº¤ä»˜**: å¯ç”¨çš„åŸºç¡€ LSPï¼Œæ”¯æŒè¡¥å…¨å’Œè¯Šæ–­

---

### Phase 2: ç”¨æˆ·ä½“éªŒä¼˜åŒ– ğŸ”„ (è¿›è¡Œä¸­ - 2å‘¨)

**ç›®æ ‡**: æå‡ IDE ä½¿ç”¨ä½“éªŒ

#### Week 1: æ ¸å¿ƒä¿®å¤

- [ ] **ç²¾ç¡®ç¬¦å·ä½ç½®** (2-3å¤©) â­â­â­
  - åœ¨ Parser æ·»åŠ  Span è·Ÿè¸ª
  - æ›´æ–°æ‰€æœ‰ AST èŠ‚ç‚¹
  - ä¿®å¤è·³è½¬åˆ°å®šä¹‰
  
- [ ] **å®Œå–„ Hover** (1-2å¤©) â­â­â­
  - å˜é‡æ‚¬åœæ˜¾ç¤ºç±»å‹
  - å‡½æ•°æ‚¬åœæ˜¾ç¤ºç­¾å
  - å†…ç½®å‡½æ•°æ˜¾ç¤ºæ–‡æ¡£

#### Week 2: å¢å¼ºåŠŸèƒ½

- [ ] **æŸ¥æ‰¾å¼•ç”¨** (1-2å¤©) â­â­
  - å®ç° `textDocument/references`
  - é«˜äº®æ‰€æœ‰å¼•ç”¨ä½ç½®
  
- [ ] **ä»£ç ç‰‡æ®µ** (1å¤©) â­â­
  - æ·»åŠ å¸¸ç”¨æ¨¡æ¿ï¼ˆfor, func, if ç­‰ï¼‰
  - é…ç½® snippets.json

- [ ] **æ¸…ç† Warnings** (0.5å¤©)
  - è¿è¡Œ `cargo fix`
  - ç§»é™¤æœªä½¿ç”¨å¯¼å…¥

**äº¤ä»˜**: å®Œæ•´çš„åŸºç¡€ IDE ä½“éªŒ

---

### Phase 3: é«˜çº§åŠŸèƒ½ (1ä¸ªæœˆ)

**ç›®æ ‡**: æä¾›ä¸“ä¸šçº§ IDE åŠŸèƒ½

#### Week 3-4: é‡æ„æ”¯æŒ

- [ ] **é‡å‘½ååŠŸèƒ½** (2-3å¤©) â­â­â­
  - å®ç° `textDocument/rename`
  - éªŒè¯å‘½åçº¦å®š
  - æ‰¹é‡æ›´æ–°å¼•ç”¨

- [ ] **ä»£ç æ ¼å¼åŒ–** (3-4å¤©) â­â­
  - å®ç° `textDocument/formatting`
  - ç¼©è¿›ã€ç©ºæ ¼ã€æ¢è¡Œè§„åˆ™
  - é…ç½®æ ¼å¼åŒ–é€‰é¡¹

#### Week 5-6: å¯¼èˆªå¢å¼º

- [ ] **å·¥ä½œåŒºç¬¦å·** (2å¤©) â­
  - å®ç° `workspace/symbol`
  - æ”¯æŒæ¨¡ç³Šæœç´¢
  - Cmd+T å¿«é€Ÿè·³è½¬

- [ ] **ä»£ç æŠ˜å ** (1å¤©)
  - å®ç° `textDocument/foldingRange`
  - æ”¯æŒå‡½æ•°ã€å¾ªç¯ã€æ³¨é‡ŠæŠ˜å 

- [ ] **é¢åŒ…å±‘å¯¼èˆª** (1å¤©)
  - æ˜¾ç¤ºå½“å‰æ‰€åœ¨å‡½æ•°/ä½œç”¨åŸŸ

**äº¤ä»˜**: æ¥è¿‘ä¸»æµ IDE çš„åŠŸèƒ½

---

### Phase 4: è¯­ä¹‰åˆ†æ (2-3ä¸ªæœˆ)

**ç›®æ ‡**: æ™ºèƒ½ä»£ç åˆ†æ

#### Month 3: ç±»å‹ç³»ç»Ÿ

- [ ] **ç±»å‹æ¨æ–­åŸºç¡€** (1-2å‘¨) â­â­â­
  - åŸºæœ¬ç±»å‹æ¨æ–­ï¼ˆNumber, String, Array, Dictï¼‰
  - å‡½æ•°è¿”å›ç±»å‹æ¨æ–­
  - å˜é‡ç±»å‹ä¼ æ’­

- [ ] **ç±»å‹é”™è¯¯æ£€æµ‹** (1å‘¨) â­â­
  - æ£€æµ‹ç±»å‹ä¸åŒ¹é…
  - è¿ç®—ç¬¦ç±»å‹æ£€æŸ¥
  - å‡½æ•°å‚æ•°ç±»å‹æ£€æŸ¥

#### Month 4: ä»£ç è´¨é‡

- [ ] **æœªä½¿ç”¨å˜é‡æ£€æµ‹** (3-5å¤©) â­â­
  - æ ‡è®°æœªä½¿ç”¨çš„å˜é‡
  - æ ‡è®°æœªä½¿ç”¨çš„å‡½æ•°

- [ ] **æ­»ä»£ç æ£€æµ‹** (3å¤©)
  - æ£€æµ‹ä¸å¯è¾¾ä»£ç 
  - æ£€æµ‹æ— æ•ˆæ¡ä»¶

- [ ] **æ™ºèƒ½å»ºè®®** (1å‘¨)
  - æç¤ºå¯ä¼˜åŒ–ä»£ç 
  - æç¤ºä»£ç åå‘³é“

**äº¤ä»˜**: æ™ºèƒ½çš„ä»£ç åˆ†æå’Œå»ºè®®

---

### Phase 5: è°ƒè¯•å’Œæµ‹è¯• (1-2ä¸ªæœˆ) - å¯é€‰

**ç›®æ ‡**: å®Œæ•´çš„å¼€å‘å·¥ä½œæµ

- [ ] **è°ƒè¯•æ”¯æŒ (DAP)** (2-3å‘¨)
  - æ–­ç‚¹æ”¯æŒ
  - å•æ­¥æ‰§è¡Œ
  - å˜é‡æŸ¥çœ‹
  - è°ƒç”¨æ ˆ

- [ ] **æµ‹è¯•æ¡†æ¶é›†æˆ** (1-2å‘¨)
  - è¯†åˆ«æµ‹è¯•å‡½æ•°
  - ä¸€é”®è¿è¡Œæµ‹è¯•
  - æ˜¾ç¤ºæµ‹è¯•ç»“æœ

**äº¤ä»˜**: å®Œæ•´çš„å¼€å‘+è°ƒè¯•+æµ‹è¯•ç¯å¢ƒ

---

## ğŸ¨ åŠŸèƒ½è¯¦ç»†è®¾è®¡

### 1. ç²¾ç¡®ç¬¦å·ä½ç½® (Priority 1)

#### å½“å‰é—®é¢˜

```rust
// symbols.rs - æ‰€æœ‰ç¬¦å·ä½ç½®éƒ½æ˜¯å ä½ç¬¦
range: Range {
    start: Position { line: 0, character: 0 },  // âŒ é”™è¯¯
    end: Position { line: 0, character: 0 },
}
```

#### è§£å†³æ–¹æ¡ˆ

```rust
// token.rs - æ‰©å±• Token åŒ…å«ä½ç½®ä¿¡æ¯
pub struct Token {
    pub kind: TokenKind,
    pub span: Span,  // æ–°å¢
    pub text: String,
}

pub struct Span {
    pub start: usize,  // å­—ç¬¦åç§»
    pub end: usize,
    pub line: usize,   // è¡Œå·
    pub column: usize, // åˆ—å·
}

// ast.rs - æ‰€æœ‰ AST èŠ‚ç‚¹æ·»åŠ  span
pub struct Stmt {
    pub kind: StmtKind,
    pub span: Span,  // æ–°å¢
}

// parser.rs - è§£ææ—¶è®°å½•ä½ç½®
fn parse_set_statement(&mut self) -> Result<Stmt> {
    let start = self.current_token.span.start;
    // ... è§£æé€»è¾‘ ...
    let end = self.previous_token.span.end;
    
    Ok(Stmt {
        kind: StmtKind::Set { ... },
        span: Span { start, end, ... },
    })
}
```

#### æµ‹è¯•éªŒè¯

```aether
Func MY_FUNCTION(X) {  // Line 1, Char 5-16
    Return (X * 2)
}

Set RESULT MY_FUNCTION(5)  // Line 5
           ^^^^^^^^^^^
           Cmd+Click åº”è¯¥è·³è½¬åˆ° Line 1
```

---

### 2. Hover åŠŸèƒ½ (Priority 1)

#### å®ç°æ­¥éª¤

```rust
// backend.rs
impl Backend {
    async fn hover(&self, params: HoverParams) -> Result<Option<Hover>> {
        let uri = &params.text_document_position_params.text_document.uri;
        let position = params.text_document_position_params.position;
        
        let doc = match self.documents.get(uri) {
            Some(doc) => doc,
            None => return Ok(None),
        };
        
        // 1. æ£€æŸ¥æ˜¯å¦æ˜¯å†…ç½®å‡½æ•°
        if let Some(builtin) = check_builtin_at_position(position) {
            return Ok(Some(create_builtin_hover(builtin)));
        }
        
        // 2. æ£€æŸ¥æ˜¯å¦æ˜¯ç”¨æˆ·å®šä¹‰ç¬¦å·
        if let Some(symbol) = doc.symbols.find_at_position(position) {
            return Ok(Some(create_symbol_hover(symbol)));
        }
        
        Ok(None)
    }
}
```

#### æ˜¾ç¤ºæ•ˆæœ

```
æ‚¬åœåœ¨ PRINTLN ä¸Š:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PRINTLN(value...)                   â”‚
â”‚                                     â”‚
â”‚ æ‰“å°å€¼åˆ°æ§åˆ¶å°å¹¶æ¢è¡Œ                â”‚
â”‚                                     â”‚
â”‚ åˆ†ç±»: IO                            â”‚
â”‚                                     â”‚
â”‚ ç¤ºä¾‹:                               â”‚
â”‚   PRINTLN("Hello World")            â”‚
â”‚   PRINTLN(MY_VAR, MY_VAR2)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ‚¬åœåœ¨ MY_FUNCTION ä¸Š:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Func MY_FUNCTION(X)                 â”‚
â”‚                                     â”‚
â”‚ å®šä¹‰ä½ç½®: example.aether:5          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 3. ä»£ç æ ¼å¼åŒ– (Priority 2)

#### æ ¼å¼åŒ–è§„åˆ™

```aether
# è¾“å…¥ï¼ˆæœªæ ¼å¼åŒ–ï¼‰
Set X 42
Func MY_FUNC(A,B){Return A+B}
Set ARR[1,2,3]
If(X>0){PRINTLN("Positive")}

# è¾“å‡ºï¼ˆæ ¼å¼åŒ–åï¼‰
Set X 42

Func MY_FUNC(A, B) {
    Return (A + B)
}

Set ARR [1, 2, 3]

If (X > 0) {
    PRINTLN("Positive")
}
```

#### è§„åˆ™æ¸…å•

- ç¼©è¿›: 4 ç©ºæ ¼
- è¿ç®—ç¬¦ä¸¤ä¾§ç©ºæ ¼: `A + B`ï¼Œ`X > 0`
- å‡½æ•°å‚æ•°é—´ç©ºæ ¼: `FUNC(A, B)`
- æ•°ç»„å…ƒç´ é—´ç©ºæ ¼: `[1, 2, 3]`
- æ‹¬å·å‰ç©ºæ ¼: `If (condition)`
- å¤§æ‹¬å·ç‹¬ç«‹è¡Œæˆ–åŒè¡Œå–å†³äºé•¿åº¦
- å‡½æ•°é—´ç©ºè¡Œ
- Return è¡¨è¾¾å¼æ‹¬å·åŒ–

---

### 4. é‡å‘½ååŠŸèƒ½ (Priority 2)

#### å®ç°æµç¨‹

```rust
// backend.rs
async fn rename(&self, params: RenameParams) -> Result<Option<WorkspaceEdit>> {
    // 1. éªŒè¯æ–°åç§°
    let new_name = params.new_name;
    if !is_upper_snake_case(&new_name) {
        return Err(Error::new(ErrorCode::InvalidParams, 
            format!("åç§°å¿…é¡»æ˜¯ UPPER_SNAKE_CASE: {}", suggest_name(&new_name))));
    }
    
    // 2. æ‰¾åˆ°æ‰€æœ‰å¼•ç”¨
    let references = find_all_references(uri, position);
    
    // 3. åˆ›å»ºç¼–è¾‘æ“ä½œ
    let edits = references.iter().map(|loc| {
        TextEdit {
            range: loc.range,
            new_text: new_name.clone(),
        }
    }).collect();
    
    Ok(Some(WorkspaceEdit { changes, ... }))
}
```

#### ä½¿ç”¨ç¤ºä¾‹

```aether
# é‡å‘½åå‰
Set my_var 42
PRINTLN(my_var)

# å³é”® my_var â†’ Rename â†’ è¾“å…¥ MY_VARIABLE
# è‡ªåŠ¨æ›´æ–°æ‰€æœ‰ä½ç½®:

Set MY_VARIABLE 42
PRINTLN(MY_VARIABLE)
```

---

### 5. ç±»å‹æ¨æ–­ (Priority 3)

#### ç±»å‹ç³»ç»Ÿè®¾è®¡

```rust
pub enum Type {
    Number,
    String,
    Boolean,
    Array(Box<Type>),
    Dict(HashMap<String, Type>),
    Function { params: Vec<Type>, return_type: Box<Type> },
    Unknown,
}

pub struct TypeChecker {
    symbol_types: HashMap<String, Type>,
}

impl TypeChecker {
    fn infer_expr(&mut self, expr: &Expr) -> Type {
        match &expr.kind {
            ExprKind::Number(_) => Type::Number,
            ExprKind::String(_) => Type::String,
            ExprKind::Array(items) => {
                let item_type = self.infer_expr(&items[0]);
                Type::Array(Box::new(item_type))
            }
            ExprKind::Binary { op, left, right } => {
                let left_type = self.infer_expr(left);
                let right_type = self.infer_expr(right);
                self.check_binary_op(op, left_type, right_type)
            }
            // ...
        }
    }
}
```

#### æ•ˆæœæ¼”ç¤º

```aether
Set X 42              # â† Hover æ˜¾ç¤º: X: Number
Set Y "hello"         # â† Hover æ˜¾ç¤º: Y: String
Set Z [1, 2, 3]       # â† Hover æ˜¾ç¤º: Z: Array<Number>
Set W (X + Y)         # â† é”™è¯¯: E005: Cannot add Number and String

Func DOUBLE(N) {      # â† æ¨æ–­: (Number) -> Number
    Return (N * 2)
}
```

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–è®¡åˆ’

### å½“å‰æ€§èƒ½

- å¯åŠ¨æ—¶é—´: <100ms
- è¡¥å…¨å»¶è¿Ÿ: <10ms
- è¯Šæ–­å»¶è¿Ÿ: <50ms
- å†…å­˜å ç”¨: ~20MB

### ä¼˜åŒ–ç›®æ ‡

- å¢é‡è§£æ: åªé‡æ–°è§£æä¿®æ”¹çš„éƒ¨åˆ†
- ç¬¦å·ç¼“å­˜: ç¼“å­˜è·¨æ–‡ä»¶ç¬¦å·
- å¹¶è¡Œåˆ†æ: å¤šæ–‡ä»¶å¹¶è¡Œå¤„ç†

---

## ğŸ§ª æµ‹è¯•è®¡åˆ’

### å•å…ƒæµ‹è¯•è¦†ç›–ç‡ç›®æ ‡: 80%

#### å½“å‰æµ‹è¯•

- [x] Parser æµ‹è¯• (7ä¸ª)
- [ ] Lexer æµ‹è¯•
- [ ] ç¬¦å·è¡¨æµ‹è¯•
- [ ] è¯Šæ–­æµ‹è¯•
- [ ] è¡¥å…¨æµ‹è¯•

#### é›†æˆæµ‹è¯•

- [ ] LSP åè®®æµ‹è¯•
- [ ] VSCode æ‰©å±•æµ‹è¯•
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•

---

## ğŸ“¦ å‘å¸ƒè®¡åˆ’

### v0.1.0 - MVP (å½“å‰)

- åŸºç¡€ LSP åŠŸèƒ½
- ä»£ç è¡¥å…¨å’Œè¯Šæ–­
- VSCode æ‰©å±•

### v0.2.0 - å¢å¼ºç‰ˆ (1ä¸ªæœˆå)

- ç²¾ç¡®ç¬¦å·ä½ç½®
- Hover åŠŸèƒ½
- é‡å‘½åå’ŒæŸ¥æ‰¾å¼•ç”¨
- ä»£ç ç‰‡æ®µ

### v0.3.0 - ä¸“ä¸šç‰ˆ (3ä¸ªæœˆå)

- ä»£ç æ ¼å¼åŒ–
- å·¥ä½œåŒºç¬¦å·
- åŸºç¡€ç±»å‹æ¨æ–­

### v1.0.0 - å®Œæ•´ç‰ˆ (6ä¸ªæœˆå)

- å®Œæ•´ç±»å‹ç³»ç»Ÿ
- æ™ºèƒ½ä»£ç åˆ†æ
- è°ƒè¯•æ”¯æŒ
- å‘å¸ƒåˆ° VSCode Marketplace

---

## ğŸ¤ ç¤¾åŒºè´¡çŒ®

### é€‚åˆæ–°æ‰‹çš„ä»»åŠ¡

- [ ] æ·»åŠ æ›´å¤šä»£ç ç‰‡æ®µ
- [ ] æ”¹è¿›é”™è¯¯æ¶ˆæ¯
- [ ] è¡¥å……æ–‡æ¡£å’Œç¤ºä¾‹
- [ ] æ·»åŠ å•å…ƒæµ‹è¯•

### ä¸­ç­‰éš¾åº¦ä»»åŠ¡

- [ ] å®ç°ä»£ç æŠ˜å 
- [ ] å®ç°æŸ¥æ‰¾å¼•ç”¨
- [ ] ä¼˜åŒ–è¡¥å…¨æ’åº

### é«˜éš¾åº¦ä»»åŠ¡

- [ ] å®ç°ç±»å‹æ¨æ–­
- [ ] å®ç°ä»£ç æ ¼å¼åŒ–
- [ ] å®ç°è°ƒè¯•æ”¯æŒ

---

## ğŸ“ åé¦ˆæ¸ é“

å¦‚æœ‰å»ºè®®æˆ–å‘ç°é—®é¢˜ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼åé¦ˆï¼š

- GitHub Issues
- Pull Requests
- è®¨è®ºåŒº

æˆ‘ä»¬æ¬¢è¿æ‰€æœ‰è´¡çŒ®ï¼ ğŸ‰
