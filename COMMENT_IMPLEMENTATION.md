# æ³¨é‡Šæå–åŠŸèƒ½ - å¼€å‘æ€»ç»“

## ğŸ“‹ éœ€æ±‚

ç”¨æˆ·æå‡ºï¼šåœ¨å˜é‡å£°æ˜è¯­å¥åï¼ˆæˆ–ä¸Šæ–¹ï¼‰åŠ ä¸Šæ³¨é‡Šæ—¶ï¼Œèƒ½å¦åœ¨ä»£ç è¡¥å…¨ä¸­å°†æ³¨é‡Šæ·»åŠ åˆ°å˜é‡çš„è§£é‡Šä¸­ï¼Ÿ

Aether çš„æ³¨é‡Šæ ¼å¼ï¼š`//` å’Œ `/* */`

## âœ… å®ç°æˆæœ

### 1. åŠŸèƒ½ç‰¹æ€§

âœ… **æ”¯æŒå•è¡Œæ³¨é‡Š `//`**

```aether
// è¿™æ˜¯ç”¨æˆ·çš„åå­—
Set MY_NAME "Alice"
```

âœ… **æ”¯æŒå¤šè¡Œè¿ç»­æ³¨é‡Š**

```aether
// ç”¨æˆ·çš„å¹´é¾„
// æ³¨æ„ï¼šè¿™æ˜¯æ•´æ•°ç±»å‹
Set MY_AGE 25
```

âœ… **æ”¯æŒå•è¡Œå—æ³¨é‡Š `/* */`**

```aether
/* è¿™æ˜¯ä¸€ä¸ªé‡è¦çš„å¸¸é‡ */
Set MAX_SIZE 100
```

âœ… **æ”¯æŒå¤šè¡Œå—æ³¨é‡Š**

```aether
/*
å¤šè¡Œæ³¨é‡Šç¤ºä¾‹
è¿™ä¸ªå˜é‡å­˜å‚¨äº†ä¸€ä¸ªæ•°ç»„
åŒ…å«äº†å‰5ä¸ªå¶æ•°
*/
Set EVEN_NUMBERS [2, 4, 6, 8, 10]
```

âœ… **åœ¨è¡¥å…¨ä¸­æ˜¾ç¤ºæ³¨é‡Š**

- å˜é‡è¡¥å…¨æ—¶æ˜¾ç¤ºæ³¨é‡Šæ–‡æ¡£
- Hover æç¤ºæ—¶æ˜¾ç¤ºæ³¨é‡Šå†…å®¹
- Markdown æ ¼å¼æ¸²æŸ“

### 2. æŠ€æœ¯å®ç°

#### ä¿®æ”¹çš„æ–‡ä»¶

1. **`src/symbols.rs`** - æ·»åŠ æ³¨é‡Šæå–é€»è¾‘

   æ–°å¢å‡½æ•°ï¼š
   - `find_comment_for_variable(text, var_name)` - æŸ¥æ‰¾å˜é‡å¯¹åº”çš„ Set è¯­å¥
   - `extract_preceding_comment(text, target_line)` - æå–æŒ‡å®šè¡Œä¸Šæ–¹çš„æ³¨é‡Š

   ä¿®æ”¹å‡½æ•°ï¼š
   - `extract_symbols_from_stmt()` - æå–ç¬¦å·æ—¶åŒæ—¶æå–æ³¨é‡Š
   - æ‰€æœ‰é€’å½’è°ƒç”¨æ”¹ä¸ºä¼ é€’ `text` å‚æ•°ï¼ˆè€Œä¸æ˜¯ `_text`ï¼‰

2. **`examples/test_comments.aether`** - åˆ›å»ºæµ‹è¯•æ–‡ä»¶

3. **æ–‡æ¡£**ï¼š
   - `COMMENT_EXTRACTION.md` - è¯¦ç»†åŠŸèƒ½è¯´æ˜
   - `DEMO_GUIDE.md` - æ¼”ç¤ºæŒ‡å—
   - `README.md` - æ›´æ–°ç‰¹æ€§åˆ—è¡¨

#### æ ¸å¿ƒç®—æ³•

```rust
/// Find comment for a variable by searching for "Set VARIABLE_NAME" pattern
fn find_comment_for_variable(text: &str, var_name: &str) -> String {
    let lines: Vec<&str> = text.lines().collect();
    
    // 1. æœç´¢åŒ…å« "Set VARIABLE_NAME" çš„è¡Œ
    for (idx, line) in lines.iter().enumerate() {
        let trimmed = line.trim();
        if trimmed.starts_with("Set ") || trimmed.starts_with("set ") {
            let parts: Vec<&str> = trimmed.split_whitespace().collect();
            if parts.len() >= 2 && parts[1] == var_name {
                // 2. æ‰¾åˆ°åæå–ä¸Šæ–¹çš„æ³¨é‡Š
                return extract_preceding_comment(text, idx);
            }
        }
    }
    
    String::new()
}

/// Extract comment from the lines above a given line
fn extract_preceding_comment(text: &str, target_line: usize) -> String {
    let lines: Vec<&str> = text.lines().collect();
    let mut comments = Vec::new();
    let mut line_idx = target_line.saturating_sub(1);

    // å‘ä¸Šéå†æ”¶é›†æ³¨é‡Š
    while line_idx > 0 {
        line_idx -= 1;
        let line = lines[line_idx].trim();

        if line.is_empty() {
            continue; // ç©ºè¡Œç»§ç»­å‘ä¸Š
        } else if line.starts_with("//") {
            // å•è¡Œæ³¨é‡Š
            let comment = line.trim_start_matches("//").trim();
            comments.insert(0, comment.to_string());
        } else if line.starts_with("/*") && line.ends_with("*/") {
            // å•è¡Œå—æ³¨é‡Š
            let comment = line.trim_start_matches("/*")
                              .trim_end_matches("*/")
                              .trim();
            comments.insert(0, comment.to_string());
            break;
        } else if line.ends_with("*/") {
            // å¤šè¡Œå—æ³¨é‡Šçš„ç»“æŸ - å‘ä¸Šæ”¶é›†
            // ... (å¤„ç†å¤šè¡Œå—æ³¨é‡Š)
            break;
        } else {
            // éæ³¨é‡Šè¡Œ - åœæ­¢
            break;
        }
    }

    comments.join("\n")
}
```

#### å·¥ä½œæµç¨‹

```
ç”¨æˆ·è¾“å…¥ "MY" + Ctrl+Space
    â†“
get_completions() è¢«è°ƒç”¨
    â†“
get_variable_completions(&symbols)
    â†“
éå† symbols.variables
    â†“
æ¯ä¸ªå˜é‡çš„ documentation å­—æ®µåŒ…å«æ³¨é‡Š
    â†“
åˆ›å»º CompletionItemï¼ŒåŒ…å«ï¼š
    - label: å˜é‡å
    - kind: VARIABLE
    - detail: "Variable: XX"
    - documentation: æ³¨é‡Šå†…å®¹ï¼ˆMarkdownï¼‰
    â†“
è¿”å›ç»™ VSCode æ˜¾ç¤º
```

### 3. ç¼–è¯‘ç»“æœ

```bash
$ cargo build
   Compiling aether-lsp v0.1.0
warning: 6 warnings (non-blocking)
    Finished `dev` profile in 0.03s

$ cargo build --release
   Compiling aether-lsp v0.1.0
    Finished `release` profile in 6.39s
```

âœ… 0 errors, 6 warningsï¼ˆéƒ½æ˜¯éé˜»å¡æ€§çš„ï¼‰

### 4. æµ‹è¯•éªŒè¯

åˆ›å»ºäº† `examples/test_comments.aether` åŒ…å«ï¼š

- âœ… å•è¡Œæ³¨é‡Šç¤ºä¾‹
- âœ… å¤šè¡Œæ³¨é‡Šç¤ºä¾‹
- âœ… å•è¡Œå—æ³¨é‡Šç¤ºä¾‹
- âœ… å¤šè¡Œå—æ³¨é‡Šç¤ºä¾‹
- âœ… æ— æ³¨é‡Šå˜é‡

## ğŸ“Š åŠŸèƒ½å¯¹æ¯”

| ç‰¹æ€§ | å®ç°å‰ | å®ç°å |
|------|--------|--------|
| å˜é‡è¡¥å…¨ | âœ… æœ‰ | âœ… æœ‰ |
| è¡¥å…¨æ˜¾ç¤ºå˜é‡å | âœ… æœ‰ | âœ… æœ‰ |
| è¡¥å…¨æ˜¾ç¤ºç±»å‹ | âœ… æœ‰ | âœ… æœ‰ |
| **è¡¥å…¨æ˜¾ç¤ºæ³¨é‡Š** | âŒ **æ— ** | âœ… **æœ‰** |
| å•è¡Œæ³¨é‡Š `//` | âŒ æ—  | âœ… **æ”¯æŒ** |
| å¤šè¡Œæ³¨é‡Š `//` | âŒ æ—  | âœ… **æ”¯æŒ** |
| å—æ³¨é‡Š `/* */` | âŒ æ—  | âœ… **æ”¯æŒ** |
| Hover æ˜¾ç¤ºæ³¨é‡Š | âŒ æ—  | âœ… **æœ‰** |

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### ä»£ç 

```aether
// è¿™æ˜¯ç”¨æˆ·çš„åå­—
Set MY_NAME "Alice"

// ç”¨æˆ·çš„å¹´é¾„
// æ³¨æ„ï¼šè¿™æ˜¯æ•´æ•°ç±»å‹
Set MY_AGE 25
```

### è¡¥å…¨æ•ˆæœ

è¾“å…¥ `MY` + `Ctrl+Space`ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MY_NAME                            â”‚ ğŸ“¦ Variable
â”‚   Variable: MY_NAME                â”‚
â”‚   è¿™æ˜¯ç”¨æˆ·çš„åå­—                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ MY_AGE                             â”‚ ğŸ“¦ Variable
â”‚   Variable: MY_AGE                 â”‚
â”‚   ç”¨æˆ·çš„å¹´é¾„                        â”‚
â”‚   æ³¨æ„ï¼šè¿™æ˜¯æ•´æ•°ç±»å‹                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Hover æ•ˆæœ

é¼ æ ‡æ‚¬åœåœ¨ `MY_NAME` ä¸Šï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Variable: MY_NAME          â”‚
â”‚                            â”‚
â”‚ è¿™æ˜¯ç”¨æˆ·çš„åå­—              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” å®ç°ç»†èŠ‚

### æ³¨é‡Šæå–è§„åˆ™

1. **å‘ä¸ŠæŸ¥æ‰¾**ï¼šä» `Set VARIABLE_NAME` è¡Œå¼€å§‹å‘ä¸Š
2. **è¿ç»­æ€§**ï¼šæå–æ‰€æœ‰è¿ç»­çš„æ³¨é‡Šï¼ˆç©ºè¡Œä¸ä¸­æ–­ï¼‰
3. **åœæ­¢æ¡ä»¶**ï¼šé‡åˆ°éæ³¨é‡Šã€éç©ºè¡Œæ—¶åœæ­¢
4. **å—æ³¨é‡Š**ï¼šé‡åˆ°å—æ³¨é‡Šååœæ­¢ç»§ç»­å‘ä¸Š

### æ”¯æŒçš„æ ¼å¼

âœ… å˜é‡å£°æ˜å‰çš„æ³¨é‡Šï¼š

```aether
// æ³¨é‡Š
Set VAR value
```

âœ… å¤šè¡Œæ³¨é‡Šï¼š

```aether
// æ³¨é‡Š1
// æ³¨é‡Š2
Set VAR value
```

âœ… å¸¦ç©ºè¡Œçš„æ³¨é‡Šï¼š

```aether
// æ³¨é‡Š1

// æ³¨é‡Š2
Set VAR value
```

âœ… å—æ³¨é‡Šï¼š

```aether
/* æ³¨é‡Š */
Set VAR value
```

âŒ ä¸æ”¯æŒçš„æ ¼å¼ï¼š

```aether
Set VAR value  // è¡Œå†…æ³¨é‡Šï¼ˆä¸ä¼šæå–ï¼‰

Set VAR value
// å£°æ˜åçš„æ³¨é‡Šï¼ˆä¸ä¼šæå–ï¼‰
```

## ğŸš€ åç»­æ”¹è¿›å»ºè®®

### 1. æ‰©å±•åˆ°å‡½æ•°æ³¨é‡Šï¼ˆæœªå®ç°ï¼‰

```aether
// è®¡ç®—ä¸¤ä¸ªæ•°çš„å’Œ
// @param X: ç¬¬ä¸€ä¸ªæ•°
// @param Y: ç¬¬äºŒä¸ªæ•°
// @return: X + Y
Func ADD(X, Y) {
    Return (X + Y)
}
```

### 2. æ”¯æŒç‰¹æ®Šæ ‡è®°ï¼ˆæœªå®ç°ï¼‰

```aether
// @description: ç”¨æˆ·å¹´é¾„
// @type: Integer
// @range: 0-150
// @default: 0
Set USER_AGE 25
```

è§£æåç”Ÿæˆç»“æ„åŒ–æ–‡æ¡£ï¼š

- **æè¿°**: ç”¨æˆ·å¹´é¾„
- **ç±»å‹**: Integer
- **èŒƒå›´**: 0-150
- **é»˜è®¤å€¼**: 0

### 3. æ”¯æŒè¡Œå†…æ³¨é‡Šï¼ˆæœªå®ç°ï¼‰

```aether
Set MAX_SIZE 100  // æœ€å¤§å°ºå¯¸
```

### 4. æ”¹è¿›ä½ç½®è·Ÿè¸ªï¼ˆæœªå®ç°ï¼‰

å½“å‰ç¬¦å·ä½ç½®éƒ½æ˜¯å ä½ç¬¦ `line: 0`ï¼Œéœ€è¦ï¼š

- åœ¨ Parser ä¸­æ·»åŠ  Span è·Ÿè¸ª
- è®°å½•æ¯ä¸ªè¯­å¥çš„å‡†ç¡®è¡Œåˆ—ä½ç½®
- æ”¹è¿› jump-to-definition çš„å‡†ç¡®æ€§

### 5. ä¼˜åŒ–æ€§èƒ½ï¼ˆå¯é€‰ï¼‰

- ç¼“å­˜æ³¨é‡Šæå–ç»“æœ
- é¿å…é‡å¤è§£æ
- ä½¿ç”¨æ›´é«˜æ•ˆçš„æœç´¢ç®—æ³•

## ğŸ“ ç›¸å…³æ–‡æ¡£

- **[COMMENT_EXTRACTION.md](./COMMENT_EXTRACTION.md)** - å®Œæ•´åŠŸèƒ½è¯´æ˜å’Œä½¿ç”¨æŒ‡å—
- **[DEMO_GUIDE.md](./DEMO_GUIDE.md)** - æ¼”ç¤ºå’Œæµ‹è¯•æŒ‡å—
- **[README.md](./README.md)** - é¡¹ç›®æ€»è§ˆï¼ˆå·²æ›´æ–°ï¼‰

## ğŸ‰ æ€»ç»“

âœ… **æˆåŠŸå®ç°**ï¼šå˜é‡æ³¨é‡Šæå–å’Œæ˜¾ç¤º  
âœ… **æ”¯æŒæ ¼å¼**ï¼š`//` å’Œ `/* */` ä¸¤ç§æ³¨é‡Š  
âœ… **è¡¥å…¨å¢å¼º**ï¼šåœ¨è¡¥å…¨å’Œ Hover ä¸­æ˜¾ç¤ºæ³¨é‡Š  
âœ… **æ–‡æ¡£å®Œå–„**ï¼šåˆ›å»ºäº†è¯¦ç»†çš„ä½¿ç”¨å’Œå¼€å‘æ–‡æ¡£  
âœ… **ç¼–è¯‘é€šè¿‡**ï¼š0 errors, 6 warnings  

è¿™ä¸ªåŠŸèƒ½è®© Aether LSP çš„ä»£ç è¡¥å…¨ä½“éªŒæ›´åŠ å®Œå–„ï¼Œç”¨æˆ·ç°åœ¨å¯ä»¥ä¸ºå˜é‡æ·»åŠ ä¸°å¯Œçš„æ–‡æ¡£æ³¨é‡Šï¼Œæå‡ä»£ç å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼ğŸš€
